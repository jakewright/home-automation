package gen

import "text/template"

var tmpl *template.Template

type templateData struct {
	PackageName    string
	PackageComment []string
	Imports        []*imp
	Service        *service
}

type imp struct {
	Alias string
	Path  string
}

type service struct {
	RPCs []*rpc
}

type rpc struct {
	Name         string
	URL          string
	HTTPMethod   string
	RequestType  string
	ResponseType string
}

func init() {
	var err error
	tmpl, err = template.New("jrpc").Parse(templateText)
	if err != nil {
		panic(err)
	}
}

const templateText = `// Code generated by protoc-gen-jrpc. DO NOT EDIT.

{{ range .PackageComment }}
// {{ . }}
{{ end }}
package {{ .PackageName }}

import (
{{ range .Imports }}
    {{ .Alias }} "{{ .Path }}"
{{ end }}
)

type Builder struct {
{{ range .Service.RPCs }}
    {{ .Name }} func(request *{{ .RequestType }}) (*{{ .ResponseType }}, error)
{{ end }}
}
`
